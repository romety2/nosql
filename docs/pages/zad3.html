<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta name="generator" content="pandoc"/>
  <title>Technologie NoSQL</title>
  <link rel="stylesheet" href="../style/style.css">
</head>
<body>
	<div class = "return">
		<a href="../index.html">powrót</a>
	</div>
	<div class = "description">
		<h1 class="text-center">Zadanie 3 (Map-Reduce)</h1>
		</br>
		<p class="description-team">
			To zadanie zostało wykonane w dwuosobowym zespole o składzie Łukasz Mielewczyk oraz Marek Białousz.
			</br>
			Do rozwiązania zadania została wykorzystana baza danych <i>mongoDB</i>.
			</br>
			Każdy z nas pracował na swoich kompterach, a na końcu porównywaliśmy wyniki.
			</br>
		</p>
		<div class="menu">
			<ul>
				<li><a href="#iod">Informacje o danych</a></li>
				<li><a href="#iiko">Instalacja i konfiguracja oprogramowania</a></li>
				<ul>
					<li><a href="#iiko1">mongoDB</a></li>
				</ul>
				<li><a href="#mr">Map-Reduce</a></li>
				<ul>
					<li><a href="#mr1">schemat Map-Reduce</a></li>
				</ul>
				<li><a href="#mdb">mongoDB</a></li>
				<ul>
					<li><a href="#mdb1">import danych</a></li>
					<li><a href="#mdb2">przykładowy rekord</a></li>
					<li><a href="#mdb3">ilość kluczy</a></li>
					<li><a href="#mdb4">suma cen jednego biletu</a></li>
				</ul>
				<li><a href="#pom">Pomiar</a></li>
			</ul>
		</div>
		<h2 id="iod">Informacje o danych</h2>	
		<p class="description-data">
			Dane zawierają informacje o transakcjach.
			<a href="https://dl.dropboxusercontent.com/u/15056258/mongodb/trades.json" download>Pobierz</a>.
			</br></br>
			Kolumny:
			<ul>
				<li>_id: identyfikator tranzakcji</li>
				<li>details: detale t.j.: minimalna cena, BID'y, opóźnienia, system handlowy</li>
				<li>price: cena biletu</li>
				<li>shares: ilość biletów</li>
				<li>ticker: centrum sprzedaży</li>
				<li>ticket: nazwa biletu</li>
				<li>time: czas, od którego rozpoczęto transakcje (data i godzina)</li>
			</ul>
			</br>
			Rozmiar: 230 MB
			</br>
			Ilość: 1000001
		</p>
		</br>
		<h2 id="iiko">Instalacja i konfiguracja oprogramowania</h2>
		<h3 id="iiko1">mongoDB</h3>
		<p>
		
			Do rozwiązania zadania użyto bazy mongoDB. Należy ją pobrać ze 
			<a href="https://www.mongodb.com/download-center#community" target="_blank">strony</a>
			i zainstalować. Następnie aby uruchomić bazę danych, należy w konsoli <i>cmd</i> i wydać polecenie: 
			<div class="command">
				<code>
mongod
				</code>
			</div>
		</p>
		</br>
		<h2 id="mr">Map-Reduce</h2>
		Map-Reduce to najbardziej zaawansowany mechanizm przetwarzania zawartości bazy danych, ale jednocześnie najwolniejszy.
		Na proces Map-Reduce składa się kilka etapów.</br>
		Na etapie mapowania (ang. map) funkcja użytkownika wywoływana dla każdego dokumentu emituje dowolną liczbę (0 lub więcej) par klucz-wartość.
		W efekcie otrzymujemy olbrzymią ilość par klucz-wartość, przy czym klucz często powtarza się w wielu parach.</br>
		Na etapie tasowania (ang. shuffle) pary o tym samym kluczu są agregowane w parę klucz-tablica_wartości.</br>
		Funkcja redukcji (ang. reduce) napisana przez użytkownika pobiera na wejściu parametry klucz,
		tablica_wartości i redukuje tablicę do jednego elementu. Funkcja reduce musi mieć taką własność,
		że jej wynik może być użyty jako element tablicy przekazanej jako drugi argument do kolejnego wywołania reduce.</br>
		<h3 id="mr1">schemat Map-Reduce</h3>
		Schemat wywołania procesu Map-Reduce: 
		<div class="command">
			<code>
{</br>
&nbsp;&nbsp;"result": "result", <i>//miejsce w którym został zapisany wynik obliczeń umieszczony</i></br>
&nbsp;&nbsp;"timeMillis": 1, <i>//czas obliczeń w milisekundach</i></br>
&nbsp;&nbsp;"counts": {</br>
&nbsp;&nbsp;&nbsp;&nbsp;"input": 1000001, <i>//ilość danych</i></br>
&nbsp;&nbsp;&nbsp;&nbsp;"emit": 0, <i>//ilość wygenerowanych par klucz-wartość</i></br>
&nbsp;&nbsp;&nbsp;&nbsp;"reduce": 0, <i>//odpowiedź na główny problem</i></br>
&nbsp;&nbsp;&nbsp;&nbsp;"output": 0 <i>//ilość elementów kolekcji wynikowej</i></br>
&nbsp;&nbsp;},</br>
&nbsp;&nbsp;"ok": 1</br>
}
			</code>
		</div>
		<h2 id="mdb">mongoDB</h2>
		<h3 id="mdb1">import danych</h3>
		<p>
			Następnie aby zaimportować z pliku do bazy danych (oczywiście baza danych musi być uruchomiona) należy wydać w <i>cmd</i> polecenie:
			<div class="command">
				<code>
mongoimport --db test --collection test --file trades.json
				</code>
			</div>
			Import powinien powodować duże zużycie zasobów (ilustracja niżej):
			</br></br>
			<div class="text-center">
				<img src="../images/screen4.PNG" height="400em" width="500em">
			</div>
			<div class="description-image">Procesor podczas importu danych do mongoDB</div>
			</br></br>
			<div class="text-center">
				<img src="../images/screen5.PNG" height="400em" width="500em">
			</div>
			<div class="description-image">Pamięć podczas importu danych do mongoDB</div>
			</br></br>
			<div class="text-center">
				<img src="../images/screen6.PNG" height="400em" width="500em">
			</div>
			<div class="description-image">Dysk podczas importu danych do mongoDB</div>
			</br></br>
			Wykonanie trwało ok. 2 minut.
			</br>
			Ostatecznie powinien pojawić się komunikat: "imported 1000001 documents"
			</br></br>
		</p>
		</br>
		<h3 id="mdb2">przykładowy rekord</h3>
			Przed wykonaniem czynności upewnij się czy dane zostały zaimportowane. Jeśli nie: <a href="#mdb1">przeczytaj jak to zrobić</a>.
			</br></br>
			Aby poznać listę oraz ilość kluczy, należy:</br>
			Strzworzyć poniższą funcję <i>map</i>:
			<div class="command">
				<code>
var mapFun = function() { emit(null, this); };
				</code>
			</div>
			Strzworzyć poniższą funcję <i>reduce</i>:
			<div class="command">
				<code>
var reduceFun = function(key, emits) { return emits[0];};
				</code>
			</div>
			Wywołać proces Map-Reduce:
			<div class="command">
				<code>
mr = db.test.mapReduce(mapFun, reduceFun, { out: "exampleRecord" })
				</code>
			</div>
			<div class="text-center">
				<img src="../images/screen29.PNG" height="150em" width="300em">
			</div>
			<div class="description-image">Proces Map-Reduce - przykładowy rekord</div>
			Aby zobaczyć wynik należy wykonać polecenie:
			<div class="command">
				<code>
db[mr.result].find();
				</code>
			</div>
			<div class="text-center">
				<img src="../images/screen30.PNG" height="50em" width="1200em">
			</div>
			<div class="description-image">Wynik wykonania Map-Reduce - przykładowy rekord</div>
			</br>
			Map-Reduce nie jest najlepszym narzędziem do wyświetlania przykładowego rekordu.
		</p>
		</p>
		</br>	
		<h3 id="mdb3">ilość kluczy</h3>
		<p>
			Przed wykonaniem czynności upewnij się czy dane zostały zaimportowane. Jeśli nie: <a href="#mdb1">przeczytaj jak to zrobić</a>.
			</br></br>
			Aby poznać listę oraz ilość kluczy, należy:</br>
			Strzworzyć poniższą funcję <i>map</i>:
			<div class="command">
				<code>
var mapFun = function() {for( var key in this ) { emit( key, { count: 1 });}};
				</code>
			</div>
			Strzworzyć poniższą funcję <i>reduce</i>:
			<div class="command">
				<code>
var reduceFun = function(key, emits) {total = 0; for( var i in emits ) {total += emits[i].count;} return { "count": total };};
				</code>
			</div>
			Wywołać proces Map-Reduce:
			<div class="command">
				<code>
mr = db.test.mapReduce(mapFun, reduceFun, { out: "quantityKeys" })
				</code>
			</div>
			<div class="text-center">
				<img src="../images/screen27.PNG" height="150em" width="300em">
			</div>
			<div class="description-image">Proces Map-Reduce - ilość kluczy</div>
			Aby zobaczyć wynik należy wykonać polecenie:
			<div class="command">
				<code>
db[mr.result].find();
				</code>
			</div>
			<div class="text-center">
				<img src="../images/screen28.PNG" height="100em" width="400em">
			</div>
			<div class="description-image">Wynik wykonania Map-Reduce - ilość kluczy</div>
			</br>
			Można zaobserwować, że ilość danych wynosi 1000001 (klucz _id) oraz wszystkie elementy zawierają wszystkie klucze.
		</p>
		<h3 id="mdb4">suma cen jednego biletu</h3>
		<p>
			Przed wykonaniem czynności upewnij się czy dane zostały zaimportowane. Jeśli nie: <a href="#mdb1">przeczytaj jak to zrobić</a>.
			</br></br>
			Aby poznać sumę cen biletu <i>z385</i>, należy:</br>
			Strzworzyć poniższą funcję <i>map</i>:
			<div class="command">
				<code>
var mapFun = function() { emit(this.ticket, this.price); };
				</code>
			</div>
			Strzworzyć poniższą funcję <i>reduce</i>:
			<div class="command">
				<code>
var reduceFun = function(key, emits) { return Array.sum(emits); };
				</code>
			</div>
			Wywołać proces Map-Reduce:
			<div class="command">
				<code>
mr = db.test.mapReduce(mapFun, reduceFun, {  query: { ticket: "z385" }, out: "exampleRecord" })
				</code>
			</div>
			<div class="text-center">
				<img src="../images/screen31.PNG" height="150em" width="300em">
			</div>	
			<div class="description-image">Proces Map-Reduce - suma cen jednego biletu</div>
			<div class="command">
				<code>
db[mr.result].find();
				</code>
			</div>
			<div class="text-center">
				<img src="../images/screen32.PNG" height="50em" width="600em">
			</div>
			<div class="description-image">Wynik wykonania Map-Reduce - suma cen jednego biletu</div>
		</p>
		<h2 id="pom">Pomiar</h2>
		Pomiar został wykonany podczasz wywołania procesu Map-Reduce.</br>
		Tabela przedstawia podsumowanie.
		</br></br>
		<table class="summary table-center">
			<tr>
				<th>Map-Reduce</th>
				<th>Ł. Mielewczyk</th>
				<th>M. Białousz</th>
			</tr>
			<tr>
				<td>Przykładowy rekord</td>
				<td>15616 ms</td>
				<td>16011 ms</td>
			</tr>
			<tr>
				<td>Ilość kluczy</td>
				<td>56238 ms</td>
				<td>57885 ms</td>
			</tr>
			<tr>
				<td>Suma cen jednego biletu</td>
				<td>1403 ms</td>
				<td>1496 ms</td>
			</tr>
		</table>
		</br>
-----------------------------
		</br>
		Porównanie obu komputerów.
		</br>
		<h3 id="iok-lm">Łukasz Mielewczyk</h3>
		<table class="informations table-center">
			<tr>
				<th>Nazwa</th>
				<th>Wartosć</th>
			</tr>
			<tr>
				<td>Procesor</td>
				<td>Core(TM) i3-4005U CPU 1,7 GHz 1,7 GHz</td>
			</tr>
			<tr>
				<td>RAM</td>
				<td>12 GB</td>
			</tr>
			<tr>
				<td>Dysk</td>
				<td>HDD</td>
			</tr>
			<tr>
				<td>System operacyjny</td>
				<td>Windows 10 64-bit</td>
			</tr>
			<tr>
				<td>Wersje użytych baz danych</td>
				<td>elasticsearch 5.3.0, mongoDB 3.2.6, postgreSQL 9.6.2</td>
			</tr>
		</table>
		<h3 id="iok-mb">Marek Białousz</h3>
		<table class="informations table-center">
			<tr>
				<th>Nazwa</th>
				<th>Wartość</th>
			</tr>
			<tr>
				<td>Procesor</td>
				<td>Intel Core i7-4510U 2.0 GHz</td>
			</tr>
			<tr>
				<td>RAM</td>
				<td>8,0 GB</td>
			</tr>
			<tr>
				<td>Dysk</td>
				<td>Toshiba MQ01ABD025 1TB</td>
			</tr>
			<tr>
				<td>System operacyjny</td>
				<td>Windows 8.1 x64</td>
			</tr>
			<tr>
				<td>Wersje użytych baz danych</td>
				<td>elasticsearch 5.2.2, mongoDB 3.2.6, postgreSQL 9.6.2</td>
			</tr>
		</table>
		</br>
		1. Na obu komputerach jest ta sama wersja bazy MongoDB.
		</br>
		2. Komputer Łukasza ustępuje pola jeśli chodzi o procesor (i3 - i7) - i nie odgrywa to tutaj znaczącej roli gdyż różnica GHz jest niewielka w porównaniu z różnicą pamięci RAM.
		</br>
		3. Natomiast jest lepszy jeżeli chodzi o ilość dostępnej pamięci RAM względem komputera Marka (12 - 8).
		</br>
		4. Ponadto system operacyjny, na którym codziennie pracuje Łukasz jest nowszy (Win 10 - Win 8.1).
		</br>
		5. Jak widać w tabelkach porównawczych wyników, każdy z pomiarów na komputerze Łukasza wykonał się szybciej, aniżeli u Marka.
		</br>
		Wyjaśnienie obserwacji:
		</br>
		- Okazuje się, że pojemność pamięci RAM ma kluczowy wpływ na oceny uzystkiwane w teście RAM i bez względu na szybkość transmisji determinuje maksymalny możliwy rezultat.
		</br>
			- Jeśli Twój komputer będzie służyć do podstawowych zastosowań, optymalne i zalecane jest wyposażenie go w minimum 4-6 GB RAM.
		</br>
			Komputer oferujący wyższą wydajność oraz większy komfort pracy z otwartymi kilkoma aplikacjami równocześnie, oraz komputer dla gracza, powinien dysponować minimum 8 GB RAM.
		</br>
			Komputer do profesjonalnych prac, który ma sprostać bardzo wymagającym aplikacjom (np: do prac graficznych 2D lub 3D, montażu wideo), oraz komputery dla wymagających graczy, dobrze wyposażyć w co najmniej 16 GB RAM.
		</br>
			Niektóre profesjonalne aplikacje mogą zaoferować wyższy komfort pracy, gdy komputer wyposażony jest jeszcze więcej pamięci RAM, np: 24 lub 32GB. Szczególnie gdy pracujemy z bardzo dużymi plikami danych.
		</br>
		- Pamięć RAM jaką posiada komputer Marka jest zatem wymaganym minimum potrzebnym do tych badań, jednakże przy pamięci Łukasza, różnica jest zauważalna (tylko przy sprawdzeniu czasu zapytania, gdyż czynności niekiedy trwają kilka sekund).
		</br>
		--- Zobrazowanie różnicy zasobów
		</br>
	</div>
	</br>
	<div class = "return">
		<a href="../index.html">powrót</a>
	</div>
</body>
