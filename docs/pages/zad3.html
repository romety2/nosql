<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta name="generator" content="pandoc"/>
  <title>Technologie NoSQL</title>
  <link rel="stylesheet" href="../style/style.css">
</head>
<body>
	<div class = "return">
		<a href="../index.html">powrót</a>
	</div>
	<div class = "description">
		<h1 class="text-center">Zadanie 3 (Map-Reduce)</h1>
		</br>
		<p class="description-team">
			To zadanie zostało wykonane w dwuosobowym zespole o składzie Łukasz Mielewczyk oraz Marek Białousz.
			</br>
			Do rozwiązania zadania została wykorzystana baza danych <i>mongoDB</i>.
			</br>
			Każdy z nas pracował na swoich kompterach, a na końcu porównywaliśmy wyniki.
			</br>
		</p>
		<div class="menu">
			<ul>
				<li><a href="#iod">Informacje o danych</a></li>
				<li><a href="#iiko">Instalacja i konfiguracja oprogramowania</a></li>
				<ul>
					<li><a href="#iiko1">mongoDB</a></li>
				</ul>
				<li><a href="#mr">Map-Reduce</a></li>
				<ul>
					<li><a href="#mr1">Schemat Map-Reduce</a></li>
				</ul>
				<li><a href="#mdb">mongoDB</a></li>
				<ul>
					<li><a href="#mdb1">import danych</a></li>
					<li><a href="#mdb2">przykładowy rekord</a></li>
					<li><a href="#mdb3">ilość kluczy</a></li>
				</ul>
				<li><a href="#pom">Pomiar</a></li>
			</ul>
		</div>
		<h2 id="iod">Informacje o danych</h2>	
		<p class="description-data">
			Dane zawierają informacje o transakcjach.
			<a href="https://dl.dropboxusercontent.com/u/15056258/mongodb/trades.json" download>Pobierz</a>.
			</br></br>
			Kolumny:
			<ul>
				<li>_id: identyfikator tranzakcji</li>
				<li>details: detale t.j.: minimalna cena, BID'y, opóźnienia, system handlowy</li>
				<li>price: cena biletu</li>
				<li>shares: ilość biletów</li>
				<li>ticker: centrum sprzedaży</li>
				<li>ticket: nazwa biletu</li>
				<li>time: czas, od którego rozpoczęto transakcje (data i godzina)</li>
			</ul>
			</br>
			Rozmiar: 230 MB
			</br>
			Ilość: 1000001
		</p>
		</br>
		<h2 id="iiko">Instalacja i konfiguracja oprogramowania</h2>
		<h3 id="iiko1">mongoDB</h3>
		<p>
		
			Do rozwiązania zadania użyto bazy mongoDB. Należy ją pobrać ze 
			<a href="https://www.mongodb.com/download-center#community" target="_blank">strony</a>
			i zainstalować. Następnie aby uruchomić bazę danych, należy w konsoli <i>cmd</i> i wydać polecenie: 
			<div class="command">
				<code>
mongod
				</code>
			</div>
		</p>
		</br>
		<h2 id="mr">Map-Reduce</h2>
		Map-Reduce to najbardziej zaawansowany mechanizm przetwarzania zawartości bazy danych, ale jednocześnie najwolniejszy.
		Na proces Map-Reduce składa się kilka etapów.</br>
		Na etapie mapowania (ang. map) funkcja użytkownika wywoływana dla każdego dokumentu emituje dowolną liczbę (0 lub więcej) par klucz-wartość.
		W efekcie otrzymujemy olbrzymią ilość par klucz-wartość, przy czym klucz często powtarza się w wielu parach.</br>
		Na etapie tasowania (ang. shuffle) pary o tym samym kluczu są agregowane w parę klucz-tablica_wartości.</br>
		Funkcja redukcji (ang. reduce) napisana przez użytkownika pobiera na wejściu parametry klucz,
		tablica_wartości i redukuje tablicę do jednego elementu. Funkcja reduce musi mieć taką własność,
		że jej wynik może być użyty jako element tablicy przekazanej jako drugi argument do kolejnego wywołania reduce.</br>
		<h3 id="mr1">Schemat Map-Reduce</h3>
		Schemat wywołania procesu Map-Reduce: 
		<div class="command">
			<code>
{</br>
&nbsp;&nbsp;"result": "result", <i>//miejsce w którym został zapisany wynik obliczeń umieszczony</i></br>
&nbsp;&nbsp;"timeMillis": 1, <i>//czas obliczeń w milisekundach</i></br>
&nbsp;&nbsp;"counts": {</br>
&nbsp;&nbsp;&nbsp;&nbsp;"input": 1000001, <i>//ilość danych</i></br>
&nbsp;&nbsp;&nbsp;&nbsp;"emit": 0, <i>//ilość wygenerowanych par klucz-wartość</i></br>
&nbsp;&nbsp;&nbsp;&nbsp;"reduse": 0, <i>//??</i></br>
&nbsp;&nbsp;&nbsp;&nbsp;"output": 0 <i>//ilość elementów kolekcji wynikowej</i></br>
&nbsp;&nbsp;},</br>
&nbsp;&nbsp;"ok": 1</br>
}
			</code>
		</div>
		<h2 id="mdb">mongoDB</h2>
		<h3 id="mdb1">import danych</h3>
		<p>
			Następnie aby zaimportować z pliku do bazy danych (oczywiście baza danych musi być uruchomiona) należy wydać w <i>cmd</i> polecenie:
			<div class="command">
				<code>
mongoimport --db test --collection test --file trades.json
				</code>
			</div>
			Import powinien powodować duże zużycie zasobów (ilustracja niżej):
			</br></br>
			<div class="text-center">
				<img src="../images/screen4.PNG" height="400em" width="500em">
			</div>
			<div class="description-image">Procesor podczas importu danych do mongoDB</div>
			</br></br>
			<div class="text-center">
				<img src="../images/screen5.PNG" height="400em" width="500em">
			</div>
			<div class="description-image">Pamięć podczas importu danych do mongoDB</div>
			</br></br>
			<div class="text-center">
				<img src="../images/screen6.PNG" height="400em" width="500em">
			</div>
			<div class="description-image">Dysk podczas importu danych do mongoDB</div>
			</br></br>
			Wykonanie trwało ok. 2 minut.
			</br>
			Ostatecznie powinien pojawić się komunikat: "imported 1000001 documents"
			</br></br>
		</p>
		</br>
		<h3 id="mdb2">przykładowy rekord</h3>
		<p>
			Przed wykonaniem czynności upewnij się czy dane zostały zaimportowane. Jeśli nie: <a href="#mdb1">przeczytaj jak to zrobić</a>.
			</br></br>
			Aby wyświetlić przykładową daną, początkowo trzeba włączyć mongo shell. Polecenie:
			<div class="command">
				<code>
mongo
				</code>
			</div>
		<p>
			Przed wykonaniem czynności upewnij się czy dane zostały zaimportowane. Jeśli nie: <a href="#mdb1">przeczytaj jak to zrobić</a>.
			</br></br>
			Aby poznać listę oraz ilość kluczy, należy
			Strzworzyć poniższą funcję <i>map</i>:
			<div class="command">
				<code>
var mapFun = function() { emit(null, this); };
				</code>
			</div>
			Strzworzyć poniższą funcję <i>reduce</i>:
			<div class="command">
				<code>
var reduceFun = function( key, emits ) { return emits[0];};
				</code>
			</div>
			Wywołać proces Map-Reduce:
			<div class="command">
				<code>
mr = db.test.mapReduce(mapFun, reduceFun, { out: "exampleRecord" } })
				</code>
			</div>
			<div class="text-center">
				<img src="../images/screen29.PNG" height="150em" width="300em">
			</div>
			<div class="description-image">Proces Map-Reduce - przykładowy rekord</div>
			Aby zobaczyć wynik należy wykonać polecenie:
			<div class="command">
				<code>
db[mr.result].find();
				</code>
			</div>
			<div class="text-center">
				<img src="../images/screen30.PNG" height="50em" width="1200em">
			</div>
			<div class="description-image">Wynik wykonania Map-Reduce - przykładowy rekord</div>
			</br>
			Map-Reduce nie jest najlepszym narzędziem do wyświetlania przykładowego rekordu.
		</p>
		</p>
		</br>	
		<h3 id="mdb3">ilość kluczy</h3>
		<p>
			Przed wykonaniem czynności upewnij się czy dane zostały zaimportowane. Jeśli nie: <a href="#mdb1">przeczytaj jak to zrobić</a>.
			</br></br>
			Aby poznać listę oraz ilość kluczy, należy
			Strzworzyć poniższą funcję <i>map</i>:
			<div class="command">
				<code>
var mapFun = function() {for( var key in this ) { emit( key, { count: 1 });}};
				</code>
			</div>
			Strzworzyć poniższą funcję <i>reduce</i>:
			<div class="command">
				<code>
var reduceFun = function(key, emits) {total = 0; for( var i in emits ) {total += emits[i].count;} return { "count": total };};
				</code>
			</div>
			Wywołać proces Map-Reduce:
			<div class="command">
				<code>
mr = db.test.mapReduce(mapFun, reduceFun, { out: "quantityKeys" })
				</code>
			</div>
			<div class="text-center">
				<img src="../images/screen27.PNG" height="150em" width="300em">
			</div>
			<div class="description-image">Proces Map-Reduce - ilość kluczy</div>
			Aby zobaczyć wynik należy wykonać polecenie:
			<div class="command">
				<code>
db[mr.result].find();
				</code>
			</div>
			<div class="text-center">
				<img src="../images/screen28.PNG" height="100em" width="400em">
			</div>
			<div class="description-image">Wynik wykonania Map-Reduce - ilość kluczy</div>
			</br>
			Można zaobserwować, że ilość danych wynosi 1000001 (klucz _id) oraz wszystkie elementy zawierają wszystkie klucze.
		</p>
		<h3 id="mdb4">2</h3>
		<p>
			Przed wykonaniem czynności upewnij się czy dane zostały zaimportowane. Jeśli nie: <a href="#mdb1">przeczytaj jak to zrobić</a>.
			</br></br>
			<div class="command">
				<code>
var mapFun = function() { emit(this.ticket, this.price); };
				</code>
			</div>
			<div class="command">
				<code>
var reduceFun = function(key, emits) { return Array.sum(emits); };
				</code>
			</div>
			<div class="command">
				<code>
mr = db.test.mapReduce(mapFun, reduceFun, { out: "sumPrice" })
				</code>
			</div>
			<div class="command">
				<code>
db[mr.result].find();
				</code>
			</div>
		</p>
		<h2 id="pom">Pomiar</h2>
		Pomiar został wykonany podczasz wywołania procesu Map-Reduce.</br>
		Tabela przedstawia podsumowanie.
		</br></br>
		<table class="summary table-center">
			<tr>
				<th>Map-Reduce</th>
				<th>Ł. Mielewczyk</th>
				<th>M. Białousz</th>
			</tr>
			<tr>
				<td>Przykładowy rekord</td>
				<td>15616 ms</td>
				<td></td>
			</tr>
			<tr>
				<td>Ilość kluczy</td>
				<td>56238 ms</td>
				<td></td>
			</tr>
		</table>
		</br>
	</div>
	</br>
	<div class = "return">
		<a href="../index.html">powrót</a>
	</div>
</body>
